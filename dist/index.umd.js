!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("tinycolor2")):"function"==typeof define&&define.amd?define(["exports","react","tinycolor2"],t):t((e||self).reactArtboard={},e.react,e.tinycolor2)}(this,function(e,t,r){function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=/*#__PURE__*/n(t),u=/*#__PURE__*/n(r);function a(e,t){var r=Math.round(Math.random()*t),n=1-Math.random()/4;return u.default(e).darken(r-t/2).setAlpha(n).toPercentageRgbString()}var i=function(e,t,r){return[r[0]+e*Math.cos(t),r[1]+e*Math.sin(t)]};function c(e){return"url("+function(e){return"data:image/svg+xml;base64,"+btoa(function(e){return"<svg xmlns='http://www.w3.org/2000/svg' width='"+e+"' height='"+e+"' viewBox='0 0 "+e+" "+e+"'><circle r='"+e/2+"' cy='"+e/2+"' cx='"+e/2+"' stroke-width='1' stroke='rgba(0,0,0,0.5)' fill='none'/></svg>"}(e))}(e)+") "+e/2+" "+e/2+", crosshair"}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s.apply(null,arguments)}var f=null;function h(){var e,t,r,n,o;if(null!==f)e=f,f=null;else{do{n=(t=2*Math.random()-1)*t+(r=2*Math.random()-1)*r}while(0===n||n>=1);e=t*(o=Math.sqrt(-2*Math.log(n)/n)),f=r*o}return e}function d(e,t,r,n,o){if(r<0)return[];var u=(e[1]+t[1])/2,a=[(e[0]+t[0])/2+h()*n,u+h()*n],i=d(e,a,r-1,n/o,o);return i.push(a),i.push.apply(i,d(a,t,r-1,n/o,o)),i}function v(e,t,r){t.beginPath(),function(e,t,r){return function(e,t,r){for(var n=[],o=0;o<e.length;o++){var u=e[o],a=e[(o+1)%e.length];n.push(u),n.push.apply(n,d(u,a,5,r,2))}return n}(function(e,t,r){for(var n=2*Math.PI/t,o=[],u=1;u<=t;u++)o.push([r*Math.cos(n*u)+e[0],r*Math.sin(n*u)+e[1]]);return o}(e,t,r),0,r/10)}(e,Math.round(r/5),r).forEach(function(e){t.lineTo.apply(t,e)}),t.closePath(),t.fill()}function g(e,t,r,n){for(var o=Math.min(r,e.length/3),u=0;u<o;u++)n.globalAlpha=.01-.009/o*u,v(e[e.length-3*u-1],n,t+t/o*u);n.globalAlpha=.1}var k=function(e){if(!e.currentTarget)return[0,0];var t=e.currentTarget.getBoundingClientRect(),r=e.targetTouches[0];return[r.clientX-t.left,r.clientY-t.top]},b=function(e){return[e.nativeEvent.offsetX,e.nativeEvent.offsetY]},p=function(e){return!(1&~e)},m=["tool","style","history","onStartStroke","onContinueStroke","onEndStroke"],S=t.forwardRef(function(e,r){var n=e.tool,u=e.style,a=e.history,i=e.onStartStroke,c=e.onContinueStroke,l=e.onEndStroke,f=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,m),h=t.useState(),d=h[0],v=h[1],g=t.useState(),S=g[0],C=g[1],y=t.useState(!1),P=y[0],M=y[1],w=t.useCallback(function(e){d&&(d.save(),M(!0),null==n.startStroke||n.startStroke(e,d),null==i||i(e))},[n,d,i]),T=t.useCallback(function(e){d&&(null==n.continueStroke||n.continueStroke(e,d),null==c||c(e))},[n,d,c]),R=t.useCallback(function(){M(!1),d&&(null==n.endStroke||n.endStroke(d),null==l||l(),d.restore(),S&&a&&a.pushState(S))},[n,d,S,a,l]),A=t.useCallback(function(e){P&&T(b(e))},[T,P]),I=t.useCallback(function(e){P&&T(k(e))},[T,P]),x=t.useCallback(function(e){P||(e.preventDefault(),w(b(e)))},[P,w]),W=t.useCallback(function(e){P||w(k(e))},[P,w]),O=t.useCallback(function(){d&&S&&(d.save(),d.fillStyle="rgba(255, 255, 255, 0)",d.fillRect(0,0,S.width,S.height),d.restore(),S&&a&&a.pushState(S))},[d,S,a]),E=t.useCallback(function(e){if(e){e.width=e.offsetWidth,e.height=e.offsetHeight;var t=e.getContext("2d");C(e),v(t),t&&(t.fillStyle="rgba(255, 255, 255, 0)",t.fillRect(0,0,e.width,e.height),t.fillStyle="transparent",a&&(a.setContext(t),a.pushState(e)))}},[a]),j=t.useCallback(function(e){p(e.buttons)?x(e):P&&R()},[P,x,R]),U=t.useCallback(function(e){P&&(T(b(e)),R())},[T,P,R]);return t.useImperativeHandle(r,function(){return{download:function(e,t){if(void 0===e&&(e="image.png"),S){var r=document.createElement("a");r.href=S.toDataURL(t),r.download=e,r.click()}},clear:O,getImageAsDataUri:function(e){return null==S?void 0:S.toDataURL(e)},context:d}},[S,d,O]),o.default.createElement("canvas",s({style:s({cursor:null==n?void 0:n.cursor,touchAction:"none"},u),onTouchStart:W,onMouseDown:x,onMouseEnter:j,onMouseMove:P?A:void 0,onTouchMove:P?I:void 0,onMouseUp:R,onMouseOut:U,onTouchEnd:R,ref:E},f))}),C=function(e,t){try{var r=new Image;return r.onload=function(){e.canvas.width=r.width,e.canvas.height=r.height,e.drawImage(r,0,0),URL.revokeObjectURL(r.src)},r.src=URL.createObjectURL(t),Promise.resolve()}catch(e){return Promise.reject(e)}};e.Artboard=S,e.circleCursor=c,e.getMousePoint=b,e.getTouchPoint=k,e.mouseButtonIsDown=p,e.useAirbrush=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.strokeWidth,a=void 0===o?25:o,i=t.useCallback(function(e,t){t.globalCompositeOperation="darken",t.lineWidth=a,t.lineJoin=t.lineCap="round",t.strokeStyle=n,t.shadowBlur=.5*a,t.shadowColor=u.default(n).setAlpha(.5).toPercentageRgbString(),console.log(t.shadowColor),t.moveTo(e[0],e[1]),t.beginPath()},[n,a]),l=t.useCallback(function(e){e.globalCompositeOperation="source-over"},[]);return{name:"Airbrush",startStroke:i,continueStroke:t.useCallback(function(e,t){t.lineTo(e[0],e[1]),t.stroke()},[]),endStroke:l,cursor:c(a)}},e.useBrush=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.strokeWidth,u=void 0===o?25:o,l=e.varyBrightness,s=void 0===l?5:l,f=t.useState([]),h=f[0],d=f[1],v=t.useRef(),g=t.useRef();return{name:"Paintbrush",startStroke:t.useCallback(function(e){v.current=void 0,d(function(e,t,r){for(var n=[],o=Math.round(e/3),u=e/o,i=0;i<o;i++){var c=0===i?0:u*i+Math.random()*u/2-u/2;n.push({distance:c,thickness:2*Math.random()+2,colour:a(t,r)})}return n}(u,n,s)),g.current=e},[d,u,n,s]),continueStroke:t.useCallback(function(e,t){if(g.current){var r=(s=v.current,c=g.current,l=e,f=(Math.atan2(l[1]-c[1],l[0]-c[0])-Math.PI/2)%(2*Math.PI),void 0===s?f:s-(n=f,o=2*Math.PI,(a=(s-(n>0?n:n+o)+Math.PI)%o-Math.PI)<-Math.PI?a+o:a));void 0===v.current&&(v.current=r%(2*Math.PI)),function(e,t,r,n,o,u,a){e.forEach(function(e){a.beginPath(),function(e,t,r,n,o){o.beginPath(),o.moveTo(e[0],e[1]),o.strokeStyle=r.colour,o.lineWidth=r.thickness,o.lineCap="round",o.lineJoin="round",o.shadowColor=r.colour,o.shadowBlur=r.thickness/2,o.quadraticCurveTo(n[0],n[1],t[0],t[1]),o.lineTo(t[0],t[1]),o.stroke()}(i(e.distance-u/2,n,t),i(e.distance-u/2,o,r),e,i(e.distance-u/2,o,t),a)})}(h,g.current,e,v.current,r,u,t),v.current=r%(2*Math.PI),g.current=e}else g.current=e;var n,o,a,c,l,s,f},[h,u]),cursor:c(u)}},e.useEraser=function(e){var r=e.strokeWidth,n=void 0===r?25:r;return{name:"Eraser",startStroke:t.useCallback(function(e,t){t.globalCompositeOperation="source-over",t.lineWidth=n,t.strokeStyle="#ffffff",t.lineJoin=t.lineCap="round",t.moveTo(e[0],e[1]),t.beginPath()},[n]),continueStroke:t.useCallback(function(e,t){t.lineTo(e[0],e[1]),t.stroke()},[]),cursor:c(n)}},e.useHistory=function(e){var r=t.useRef([]),n=t.useRef(0),o=t.useState(),u=o[0],a=o[1],i=t.useState(!1),c=i[0],l=i[1],s=t.useState(!1),f=s[0],h=s[1],d=t.useCallback(function(t){try{var o=n.current;return u?(0!==o&&(r.current=r.current.slice(0,-o),n.current=0),Promise.resolve(new Promise(function(e){return t.toBlob(e)})).then(function(t){return t&&r.current.push(t),e&&r.current.length>e&&(r.current=r.current.slice(-e)),l(r.current.length>1),h(!1),!0})):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[n,r,u]),v=t.useCallback(function(){try{var e=n.current;return u?e+1>=r.current.length?(console.log("nope"),Promise.resolve(!1)):Promise.resolve(C(u,r.current[r.current.length-(e+2)])).then(function(){return n.current++,l(n.current+1<r.current.length),h(!0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[n,r,u]),g=t.useCallback(function(){try{var e=n.current;return u?e<=0?Promise.resolve(!1):Promise.resolve(C(u,r.current[r.current.length-e])).then(function(){return n.current--,l(n.current+1<r.current.length),h(n.current>0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[r,n,u]),k=t.useCallback(function(){r.current=[]},[r]);return{history:t.useMemo(function(){return{setContext:function(e){a(e)},pushState:d}},[a,d]),undo:v,redo:g,clear:k,canUndo:c,canRedo:f}},e.useMarker=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.strokeWidth,u=void 0===o?25:o,a=t.useRef();return{name:"Marker pen",startStroke:t.useCallback(function(e,t){t.lineWidth=3,t.lineJoin=t.lineCap="round",a.current=e,t.strokeStyle=n},[n]),continueStroke:t.useCallback(function(e,t){if(a.current){if(a.current[0]!==e[0]||a.current[1]!==e[1]){t.beginPath();for(var r=0;r<u;r+=2){var n=Math.round(u/2-r);t.globalAlpha=1/u*(u-r),t.moveTo(a.current[0]-n,a.current[1]-n),t.lineTo(e[0]-n,e[1]-n),t.stroke()}t.globalAlpha=1,t.beginPath(),a.current=e}}else a.current=e},[u,a]),cursor:c(u)}},e.useShadingBrush=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.neighbourColor,a=e.distanceThreshold,i=void 0===a?40:a,c=e.neighbourStrokeWidth,s=void 0===c?1:c,f=e.spreadFactor,h=void 0===f?.9:f;o||(o=u.default(n).setAlpha(.2).toPercentageRgbString());var d=t.useRef([]),v=i*i;return{name:"Shading",startStroke:t.useCallback(function(e,t){t.globalCompositeOperation="darken",t.lineWidth=1,t.lineJoin=t.lineCap="round",d.current=[e]},[]),continueStroke:t.useCallback(function(e,t){t.strokeStyle=n,t.lineWidth=1,d.current.push(e),t.beginPath();var r=d.current[d.current.length-2];t.moveTo(r[0],r[1]),t.lineTo.apply(t,e),t.stroke(),t.lineWidth=s;for(var u,a=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(d.current);!(u=a()).done;){var i=u.value,c=i[0]-e[0],f=i[1]-e[1],g=c*c+f*f;g<v&&Math.random()>g/v&&(t.beginPath(),t.strokeStyle=o,t.moveTo(e[0]+c*h,e[1]+f*h),t.lineTo(i[0]-c*h,i[1]-f*h),t.stroke())}},[s,n,h,v,o]),endStroke:t.useCallback(function(e){e.globalCompositeOperation="source-over"},[]),cursor:"crosshair"}},e.useWatercolor=function(e){var r=e.color,n=void 0===r?"#000000":r,o=e.strokeWidth,u=void 0===o?25:o,a=t.useRef([]),i=t.useCallback(function(e,t){t.fillStyle=n,t.shadowColor=n,t.globalAlpha=.01,a.current=[e],g(a.current,1.1*u,1,t)},[n,u]),l=t.useCallback(function(){a.current=[]},[]);return{name:"Watercolor",startStroke:i,continueStroke:t.useCallback(function(e,t){a.current.push(e),g(a.current,u,5,t)},[u]),endStroke:l,cursor:c(u)}}});
//# sourceMappingURL=index.umd.js.map

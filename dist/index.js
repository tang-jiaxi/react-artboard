var e=require("react"),t=require("tinycolor2");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=/*#__PURE__*/r(e),o=/*#__PURE__*/r(t);function u(e,t){var r=Math.round(Math.random()*t),n=1-Math.random()/4;return o.default(e).darken(r-t/2).setAlpha(n).toPercentageRgbString()}var a=function(e,t,r){return[r[0]+e*Math.cos(t),r[1]+e*Math.sin(t)]};function i(e){return"url("+function(e){return"data:image/svg+xml;base64,"+btoa(function(e){return"<svg xmlns='http://www.w3.org/2000/svg' width='"+e+"' height='"+e+"' viewBox='0 0 "+e+" "+e+"'><circle r='"+e/2+"' cy='"+e/2+"' cx='"+e/2+"' stroke-width='1' stroke='rgba(0,0,0,0.5)' fill='none'/></svg>"}(e))}(e)+") "+e/2+" "+e/2+", crosshair"}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(null,arguments)}var s=null;function h(){var e,t,r,n,o;if(null!==s)e=s,s=null;else{do{n=(t=2*Math.random()-1)*t+(r=2*Math.random()-1)*r}while(0===n||n>=1);e=t*(o=Math.sqrt(-2*Math.log(n)/n)),s=r*o}return e}function f(e,t,r,n,o){if(r<0)return[];var u=(e[1]+t[1])/2,a=[(e[0]+t[0])/2+h()*n,u+h()*n],i=f(e,a,r-1,n/o,o);return i.push(a),i.push.apply(i,f(a,t,r-1,n/o,o)),i}function d(e,t,r){t.beginPath(),function(e,t,r){return function(e,t,r){for(var n=[],o=0;o<e.length;o++){var u=e[o],a=e[(o+1)%e.length];n.push(u),n.push.apply(n,f(u,a,5,r,2))}return n}(function(e,t,r){for(var n=2*Math.PI/t,o=[],u=1;u<=t;u++)o.push([r*Math.cos(n*u)+e[0],r*Math.sin(n*u)+e[1]]);return o}(e,t,r),0,r/10)}(e,Math.round(r/5),r).forEach(function(e){t.lineTo.apply(t,e)}),t.closePath(),t.fill()}function v(e,t,r,n){for(var o=Math.min(r,e.length/3),u=0;u<o;u++)n.globalAlpha=.01-.009/o*u,d(e[e.length-3*u-1],n,t+t/o*u);n.globalAlpha=.1}var g=function(e){if(!e.currentTarget)return[0,0];var t=e.currentTarget.getBoundingClientRect(),r=e.targetTouches[0];return[r.clientX-t.left,r.clientY-t.top]},k=function(e){return[e.nativeEvent.offsetX,e.nativeEvent.offsetY]},b=function(e){return!(1&~e)},p=["tool","style","history","onStartStroke","onContinueStroke","onEndStroke"],m=e.forwardRef(function(t,r){var o=t.tool,u=t.style,a=t.history,i=t.onStartStroke,c=t.onContinueStroke,s=t.onEndStroke,h=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(t,p),f=e.useState(),d=f[0],v=f[1],m=e.useState(),S=m[0],C=m[1],y=e.useState(!1),P=y[0],M=y[1],w=e.useCallback(function(e){d&&(d.save(),M(!0),null==o.startStroke||o.startStroke(e,d),null==i||i(e))},[o,d,i]),x=e.useCallback(function(e){d&&(null==o.continueStroke||o.continueStroke(e,d),null==c||c(e))},[o,d,c]),T=e.useCallback(function(){M(!1),d&&(null==o.endStroke||o.endStroke(d),null==s||s(),d.restore(),S&&a&&a.pushState(S))},[o,d,S,a,s]),R=e.useCallback(function(e){P&&x(k(e))},[x,P]),A=e.useCallback(function(e){P&&x(g(e))},[x,P]),I=e.useCallback(function(e){P||(e.preventDefault(),w(k(e)))},[P,w]),W=e.useCallback(function(e){P||w(g(e))},[P,w]),O=e.useCallback(function(){d&&S&&(d.save(),d.fillStyle="rgba(255, 255, 255, 0)",d.fillRect(0,0,S.width,S.height),d.restore(),S&&a&&a.pushState(S))},[d,S,a]),E=e.useCallback(function(e){if(e){e.width=e.offsetWidth,e.height=e.offsetHeight;var t=e.getContext("2d");C(e),v(t),t&&(t.fillStyle="rgba(255, 255, 255, 0)",t.fillRect(0,0,e.width,e.height),t.fillStyle="transparent",a&&(a.setContext(t),a.pushState(e)))}},[a]),j=e.useCallback(function(e){b(e.buttons)?I(e):P&&T()},[P,I,T]),U=e.useCallback(function(e){P&&(x(k(e)),T())},[x,P,T]);return e.useImperativeHandle(r,function(){return{download:function(e,t){if(void 0===e&&(e="image.png"),S){var r=document.createElement("a");r.href=S.toDataURL(t),r.download=e,r.click()}},clear:O,getImageAsDataUri:function(e){return null==S?void 0:S.toDataURL(e)},context:d}},[S,d,O]),n.default.createElement("canvas",l({style:l({cursor:null==o?void 0:o.cursor,touchAction:"none"},u),onTouchStart:W,onMouseDown:I,onMouseEnter:j,onMouseMove:P?R:void 0,onTouchMove:P?A:void 0,onMouseUp:T,onMouseOut:U,onTouchEnd:T,ref:E},h))}),S=function(e,t){try{var r=new Image;return r.onload=function(){e.canvas.width=r.width,e.canvas.height=r.height,e.drawImage(r,0,0),URL.revokeObjectURL(r.src)},r.src=URL.createObjectURL(t),Promise.resolve()}catch(e){return Promise.reject(e)}};exports.Artboard=m,exports.circleCursor=i,exports.getMousePoint=k,exports.getTouchPoint=g,exports.mouseButtonIsDown=b,exports.useAirbrush=function(t){var r=t.color,n=void 0===r?"#000000":r,u=t.strokeWidth,a=void 0===u?25:u,c=e.useCallback(function(e,t){t.globalCompositeOperation="darken",t.lineWidth=a,t.lineJoin=t.lineCap="round",t.strokeStyle=n,t.shadowBlur=.5*a,t.shadowColor=o.default(n).setAlpha(.5).toPercentageRgbString(),console.log(t.shadowColor),t.moveTo(e[0],e[1]),t.beginPath()},[n,a]),l=e.useCallback(function(e){e.globalCompositeOperation="source-over"},[]);return{name:"Airbrush",startStroke:c,continueStroke:e.useCallback(function(e,t){t.lineTo(e[0],e[1]),t.stroke()},[]),endStroke:l,cursor:i(a)}},exports.useBrush=function(t){var r=t.color,n=void 0===r?"#000000":r,o=t.strokeWidth,c=void 0===o?25:o,l=t.varyBrightness,s=void 0===l?5:l,h=e.useState([]),f=h[0],d=h[1],v=e.useRef(),g=e.useRef();return{name:"Paintbrush",startStroke:e.useCallback(function(e){v.current=void 0,d(function(e,t,r){for(var n=[],o=Math.round(e/3),a=e/o,i=0;i<o;i++){var c=0===i?0:a*i+Math.random()*a/2-a/2;n.push({distance:c,thickness:2*Math.random()+2,colour:u(t,r)})}return n}(c,n,s)),g.current=e},[d,c,n,s]),continueStroke:e.useCallback(function(e,t){if(g.current){var r=(s=v.current,i=g.current,l=e,h=(Math.atan2(l[1]-i[1],l[0]-i[0])-Math.PI/2)%(2*Math.PI),void 0===s?h:s-(n=h,o=2*Math.PI,(u=(s-(n>0?n:n+o)+Math.PI)%o-Math.PI)<-Math.PI?u+o:u));void 0===v.current&&(v.current=r%(2*Math.PI)),function(e,t,r,n,o,u,i){e.forEach(function(e){i.beginPath(),function(e,t,r,n,o){o.beginPath(),o.moveTo(e[0],e[1]),o.strokeStyle=r.colour,o.lineWidth=r.thickness,o.lineCap="round",o.lineJoin="round",o.shadowColor=r.colour,o.shadowBlur=r.thickness/2,o.quadraticCurveTo(n[0],n[1],t[0],t[1]),o.lineTo(t[0],t[1]),o.stroke()}(a(e.distance-u/2,n,t),a(e.distance-u/2,o,r),e,a(e.distance-u/2,o,t),i)})}(f,g.current,e,v.current,r,c,t),v.current=r%(2*Math.PI),g.current=e}else g.current=e;var n,o,u,i,l,s,h},[f,c]),cursor:i(c)}},exports.useEraser=function(t){var r=t.strokeWidth,n=void 0===r?25:r;return{name:"Eraser",startStroke:e.useCallback(function(e,t){t.globalCompositeOperation="source-over",t.lineWidth=n,t.strokeStyle="#ffffff",t.lineJoin=t.lineCap="round",t.moveTo(e[0],e[1]),t.beginPath()},[n]),continueStroke:e.useCallback(function(e,t){t.lineTo(e[0],e[1]),t.stroke()},[]),cursor:i(n)}},exports.useHistory=function(t){var r=e.useRef([]),n=e.useRef(0),o=e.useState(),u=o[0],a=o[1],i=e.useState(!1),c=i[0],l=i[1],s=e.useState(!1),h=s[0],f=s[1],d=e.useCallback(function(e){try{var o=n.current;return u?(0!==o&&(r.current=r.current.slice(0,-o),n.current=0),Promise.resolve(new Promise(function(t){return e.toBlob(t)})).then(function(e){return e&&r.current.push(e),t&&r.current.length>t&&(r.current=r.current.slice(-t)),l(r.current.length>1),f(!1),!0})):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[n,r,u]),v=e.useCallback(function(){try{var e=n.current;return u?e+1>=r.current.length?(console.log("nope"),Promise.resolve(!1)):Promise.resolve(S(u,r.current[r.current.length-(e+2)])).then(function(){return n.current++,l(n.current+1<r.current.length),f(!0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[n,r,u]),g=e.useCallback(function(){try{var e=n.current;return u?e<=0?Promise.resolve(!1):Promise.resolve(S(u,r.current[r.current.length-e])).then(function(){return n.current--,l(n.current+1<r.current.length),f(n.current>0),!0}):(console.error("Context not initialised"),Promise.resolve(!1))}catch(e){return Promise.reject(e)}},[r,n,u]),k=e.useCallback(function(){r.current=[]},[r]);return{history:e.useMemo(function(){return{setContext:function(e){a(e)},pushState:d}},[a,d]),undo:v,redo:g,clear:k,canUndo:c,canRedo:h}},exports.useMarker=function(t){var r=t.color,n=void 0===r?"#000000":r,o=t.strokeWidth,u=void 0===o?25:o,a=e.useRef();return{name:"Marker pen",startStroke:e.useCallback(function(e,t){t.lineWidth=3,t.lineJoin=t.lineCap="round",a.current=e,t.strokeStyle=n},[n]),continueStroke:e.useCallback(function(e,t){if(a.current){if(a.current[0]!==e[0]||a.current[1]!==e[1]){t.beginPath();for(var r=0;r<u;r+=2){var n=Math.round(u/2-r);t.globalAlpha=1/u*(u-r),t.moveTo(a.current[0]-n,a.current[1]-n),t.lineTo(e[0]-n,e[1]-n),t.stroke()}t.globalAlpha=1,t.beginPath(),a.current=e}}else a.current=e},[u,a]),cursor:i(u)}},exports.useShadingBrush=function(t){var r=t.color,n=void 0===r?"#000000":r,u=t.neighbourColor,a=t.distanceThreshold,i=void 0===a?40:a,l=t.neighbourStrokeWidth,s=void 0===l?1:l,h=t.spreadFactor,f=void 0===h?.9:h;u||(u=o.default(n).setAlpha(.2).toPercentageRgbString());var d=e.useRef([]),v=i*i;return{name:"Shading",startStroke:e.useCallback(function(e,t){t.globalCompositeOperation="darken",t.lineWidth=1,t.lineJoin=t.lineCap="round",d.current=[e]},[]),continueStroke:e.useCallback(function(e,t){t.strokeStyle=n,t.lineWidth=1,d.current.push(e),t.beginPath();var r=d.current[d.current.length-2];t.moveTo(r[0],r[1]),t.lineTo.apply(t,e),t.stroke(),t.lineWidth=s;for(var o,a=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(d.current);!(o=a()).done;){var i=o.value,l=i[0]-e[0],h=i[1]-e[1],g=l*l+h*h;g<v&&Math.random()>g/v&&(t.beginPath(),t.strokeStyle=u,t.moveTo(e[0]+l*f,e[1]+h*f),t.lineTo(i[0]-l*f,i[1]-h*f),t.stroke())}},[s,n,f,v,u]),endStroke:e.useCallback(function(e){e.globalCompositeOperation="source-over"},[]),cursor:"crosshair"}},exports.useWatercolor=function(t){var r=t.color,n=void 0===r?"#000000":r,o=t.strokeWidth,u=void 0===o?25:o,a=e.useRef([]),c=e.useCallback(function(e,t){t.fillStyle=n,t.shadowColor=n,t.globalAlpha=.01,a.current=[e],v(a.current,1.1*u,1,t)},[n,u]),l=e.useCallback(function(){a.current=[]},[]);return{name:"Watercolor",startStroke:c,continueStroke:e.useCallback(function(e,t){a.current.push(e),v(a.current,u,5,t)},[u]),endStroke:l,cursor:i(u)}};
//# sourceMappingURL=index.js.map

{"version":3,"file":"index.js","sources":["../src/tools/brush/brushHelpers.ts","../src/utils/cursors.ts","../src/tools/watercolor/watercolor.ts","../src/utils/pointUtils.ts","../src/components/Artboard.tsx","../src/history.ts","../src/tools/airbrush/useAirbrush.ts","../src/tools/brush/useBrush.ts","../src/tools/eraser/useEraser.ts","../src/tools/marker/useMarker.ts","../src/tools/shading/useShadingBrush.ts","../src/tools/watercolor/useWatercolor.ts"],"sourcesContent":["import tinycolor from \"tinycolor2\";\r\nimport { Point } from \"../../utils/pointUtils\";\r\n\r\nexport function varyColour(\r\n  sourceColour: string,\r\n  varyBrightness: number\r\n): string {\r\n  const amount = Math.round(Math.random() * varyBrightness);\r\n  const alpha = 1 - Math.random() / 4;\r\n  const colour = tinycolor(sourceColour);\r\n  const varied = colour.darken(amount - varyBrightness / 2).setAlpha(alpha);\r\n  return varied.toPercentageRgbString();\r\n}\r\n\r\nexport interface Bristle {\r\n  distance: number;\r\n  thickness: number;\r\n  colour: string;\r\n}\r\n\r\nexport const rotatePoint = (\r\n  distance: number,\r\n  angle: number,\r\n  origin: Point\r\n): Point => [\r\n  origin[0] + distance * Math.cos(angle),\r\n  origin[1] + distance * Math.sin(angle),\r\n];\r\n\r\nexport const getBearing = (origin: Point, destination: Point): number =>\r\n  (Math.atan2(destination[1] - origin[1], destination[0] - origin[0]) -\r\n    Math.PI / 2) %\r\n  (Math.PI * 2);\r\n\r\nexport const getNewAngle = (\r\n  origin: Point,\r\n  destination: Point,\r\n  oldAngle?: number\r\n): number => {\r\n  const bearing = getBearing(origin, destination);\r\n  if (typeof oldAngle === \"undefined\") {\r\n    return bearing;\r\n  }\r\n  return oldAngle - angleDiff(oldAngle, bearing);\r\n};\r\n\r\nexport const angleDiff = (angleA: number, angleB: number): number => {\r\n  const twoPi = Math.PI * 2;\r\n  const diff =\r\n    ((angleA - (angleB > 0 ? angleB : angleB + twoPi) + Math.PI) % twoPi) -\r\n    Math.PI;\r\n  return diff < -Math.PI ? diff + twoPi : diff;\r\n};\r\n","export function circleSVG(diameter: number) {\r\n  return `<svg xmlns='http://www.w3.org/2000/svg' width='${diameter}' height='${diameter}' viewBox='0 0 ${diameter} ${diameter}'><circle r='${\r\n    diameter / 2\r\n  }' cy='${diameter / 2}' cx='${\r\n    diameter / 2\r\n  }' stroke-width='1' stroke='rgba(0,0,0,0.5)' fill='none'/></svg>`;\r\n}\r\n\r\nexport function circleDataUri(diameter: number) {\r\n  return `data:image/svg+xml;base64,${btoa(circleSVG(diameter))}`;\r\n}\r\n\r\nexport function circleCursor(diameter: number) {\r\n  return `url(${circleDataUri(diameter)}) ${diameter / 2} ${\r\n    diameter / 2\r\n  }, crosshair`;\r\n}\r\n","import { Point } from \"../../utils/pointUtils\";\r\n\r\nlet spareRandom: number | null = null;\r\n\r\n// https://gist.github.com/bluesmoon/7925696\r\nfunction normalRandom() {\r\n  let val, u, v, s, mul;\r\n  if (spareRandom !== null) {\r\n    val = spareRandom;\r\n    spareRandom = null;\r\n  } else {\r\n    do {\r\n      u = Math.random() * 2 - 1;\r\n      v = Math.random() * 2 - 1;\r\n      s = u * u + v * v;\r\n    } while (s === 0 || s >= 1);\r\n    mul = Math.sqrt((-2 * Math.log(s)) / s);\r\n    val = u * mul;\r\n    spareRandom = v * mul;\r\n  }\r\n  return val;\r\n}\r\nexport function makePolygon(\r\n  centre: Point,\r\n  sides: number,\r\n  radius: number\r\n): Array<Point> {\r\n  const increment = (Math.PI * 2) / sides;\r\n  const result: Array<Point> = [];\r\n  for (let i = 1; i <= sides; i++) {\r\n    result.push([\r\n      radius * Math.cos(increment * i) + centre[0],\r\n      radius * Math.sin(increment * i) + centre[1],\r\n    ]);\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function deformPolygon(\r\n  points: Array<Point>,\r\n  depth: number,\r\n  variance: number,\r\n  vdiv: number\r\n): Array<Point> {\r\n  const newPoints: Array<Point> = [];\r\n  for (let i = 0; i < points.length; i++) {\r\n    const currentPoint = points[i];\r\n    const nextPoint = points[(i + 1) % points.length];\r\n    newPoints.push(currentPoint);\r\n    newPoints.push(\r\n      ...subdivideVertex(currentPoint, nextPoint, depth, variance, vdiv)\r\n    );\r\n  }\r\n  return newPoints;\r\n}\r\n\r\nfunction subdivideVertex(\r\n  currentPoint: Point,\r\n  nextPoint: Point,\r\n  depth: number,\r\n  variance: number,\r\n  vdiv: number\r\n): Array<Point> {\r\n  if (depth < 0) {\r\n    return [];\r\n  }\r\n  //   Find the midpoint\r\n  const midX = (currentPoint[0] + nextPoint[0]) / 2;\r\n  const midY = (currentPoint[1] + nextPoint[1]) / 2;\r\n\r\n  //   Nudge the midpoint\r\n  const newMidpoint: Point = [\r\n    midX + normalRandom() * variance,\r\n    midY + normalRandom() * variance,\r\n  ];\r\n\r\n  const newPoints = subdivideVertex(\r\n    currentPoint,\r\n    newMidpoint,\r\n    depth - 1,\r\n    variance / vdiv,\r\n    vdiv\r\n  );\r\n\r\n  newPoints.push(newMidpoint);\r\n  newPoints.push(\r\n    ...subdivideVertex(newMidpoint, nextPoint, depth - 1, variance / vdiv, vdiv)\r\n  );\r\n  return newPoints;\r\n}\r\n\r\nexport function getSplodge(\r\n  point: Point,\r\n  sides: number,\r\n  radius: number\r\n): Array<Point> {\r\n  return deformPolygon(makePolygon(point, sides, radius), 5, radius / 10, 2);\r\n}\r\n\r\nexport function splodgeAtPoint(\r\n  point: Point,\r\n  context: CanvasRenderingContext2D,\r\n  width: number\r\n): void {\r\n  context.beginPath();\r\n  getSplodge(point, Math.round(width / 5), width).forEach((point) => {\r\n    context.lineTo(...point);\r\n  });\r\n  context.closePath();\r\n  context.fill();\r\n}\r\n\r\nexport function splodgeTrail(\r\n  points: Array<Point>,\r\n  width: number,\r\n  trail: number,\r\n  context: CanvasRenderingContext2D\r\n): void {\r\n  const count = Math.min(trail, points.length / 3);\r\n  for (let i = 0; i < count; i++) {\r\n    context.globalAlpha = 0.01 - (0.009 / count) * i;\r\n    splodgeAtPoint(\r\n      points[points.length - i * 3 - 1],\r\n      context,\r\n      width + (width / count) * i\r\n    );\r\n  }\r\n  context.globalAlpha = 0.1;\r\n}\r\n","export type Point = [number, number];\r\n\r\nexport const getTouchPoint = (event: React.TouchEvent): Point => {\r\n  if (!event.currentTarget) {\r\n    return [0, 0];\r\n  }\r\n  const rect = event.currentTarget.getBoundingClientRect();\r\n  const touch = event.targetTouches[0];\r\n  return [touch.clientX - rect.left, touch.clientY - rect.top];\r\n};\r\n\r\nexport const getMousePoint = (event: React.MouseEvent): Point => [\r\n  event.nativeEvent.offsetX,\r\n  event.nativeEvent.offsetY,\r\n];\r\n\r\nconst BUTTON = 0b01;\r\nexport const mouseButtonIsDown = (buttons: number): boolean =>\r\n  (BUTTON & buttons) === BUTTON;\r\n","import React, {\r\n  ForwardedRef,\r\n  forwardRef,\r\n  useCallback,\r\n  useImperativeHandle,\r\n  useState,\r\n} from \"react\";\r\n\r\nimport { History } from \"../history\";\r\n\r\nimport {\r\n  getMousePoint,\r\n  getTouchPoint,\r\n  mouseButtonIsDown,\r\n  Point,\r\n} from \"../utils/pointUtils\";\r\n\r\nexport interface ArtboardProps\r\n  extends React.CanvasHTMLAttributes<HTMLCanvasElement> {\r\n  tool: ToolHandlers;\r\n  history?: History;\r\n  onStartStroke?: (point: Point) => void;\r\n  onContinueStroke?: (point: Point) => void;\r\n  onEndStroke?: () => void;\r\n}\r\n\r\nexport interface ArtboardRef {\r\n  download: (filename?: string, type?: string) => void;\r\n  getImageAsDataUri: (type?: string) => string | undefined;\r\n  clear: () => void;\r\n  context?: CanvasRenderingContext2D | null;\r\n}\r\n\r\nexport interface ToolHandlers {\r\n  name: string;\r\n  startStroke?: (point: Point, context: CanvasRenderingContext2D) => void;\r\n  continueStroke?: (point: Point, context: CanvasRenderingContext2D) => void;\r\n  endStroke?: (context: CanvasRenderingContext2D) => void;\r\n  cursor?: string;\r\n}\r\n\r\nexport const Artboard = forwardRef(function Artboard(\r\n  {\r\n    tool,\r\n    style,\r\n    history,\r\n    onStartStroke,\r\n    onContinueStroke,\r\n    onEndStroke,\r\n    ...props\r\n  }: ArtboardProps,\r\n  ref: ForwardedRef<ArtboardRef>\r\n) {\r\n  const [context, setContext] = useState<CanvasRenderingContext2D | null>();\r\n  const [canvas, setCanvas] = useState<HTMLCanvasElement>();\r\n  const [drawing, setDrawing] = useState(false);\r\n\r\n  const startStroke = useCallback(\r\n    (point: Point) => {\r\n      if (!context) {\r\n        return;\r\n      }\r\n      context.save();\r\n      setDrawing(true);\r\n      tool.startStroke?.(point, context);\r\n      onStartStroke?.(point);\r\n    },\r\n    [tool, context, onStartStroke]\r\n  );\r\n\r\n  const continueStroke = useCallback(\r\n    (newPoint: Point) => {\r\n      if (!context) {\r\n        return;\r\n      }\r\n      tool.continueStroke?.(newPoint, context);\r\n      onContinueStroke?.(newPoint);\r\n    },\r\n    [tool, context, onContinueStroke]\r\n  );\r\n\r\n  const endStroke = useCallback(() => {\r\n    setDrawing(false);\r\n    if (context) {\r\n      tool.endStroke?.(context);\r\n      onEndStroke?.();\r\n      context.restore();\r\n      if (canvas && history) {\r\n        history.pushState(canvas);\r\n      }\r\n    }\r\n  }, [tool, context, canvas, history, onEndStroke]);\r\n\r\n  const mouseMove = useCallback(\r\n    (event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) => {\r\n      if (!drawing) {\r\n        return;\r\n      }\r\n      continueStroke(getMousePoint(event));\r\n    },\r\n    [continueStroke, drawing]\r\n  );\r\n\r\n  const touchMove = useCallback(\r\n    (event: React.TouchEvent) => {\r\n      if (!drawing) {\r\n        return;\r\n      }\r\n      continueStroke(getTouchPoint(event));\r\n    },\r\n    [continueStroke, drawing]\r\n  );\r\n\r\n  const mouseDown = useCallback(\r\n    (event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) => {\r\n      if (drawing) {\r\n        return;\r\n      }\r\n      event.preventDefault();\r\n      startStroke(getMousePoint(event));\r\n    },\r\n    [drawing, startStroke]\r\n  );\r\n\r\n  const touchStart = useCallback(\r\n    (event: React.TouchEvent) => {\r\n      if (drawing) {\r\n        return;\r\n      }\r\n      startStroke(getTouchPoint(event));\r\n    },\r\n    [drawing, startStroke]\r\n  );\r\n\r\n  const clear = useCallback(() => {\r\n    if (!context || !canvas) {\r\n      return;\r\n    }\r\n    context.save();\r\n    context.fillStyle = \"rgba(255, 255, 255, 0)\";\r\n    context.fillRect(0, 0, canvas.width, canvas.height);\r\n    context.restore();\r\n    if (canvas && history) {\r\n      history.pushState(canvas);\r\n    }\r\n  }, [context, canvas, history]);\r\n\r\n  const gotRef = useCallback(\r\n    (canvasRef: HTMLCanvasElement) => {\r\n      if (!canvasRef) {\r\n        return;\r\n      }\r\n      canvasRef.width = canvasRef.offsetWidth;\r\n      canvasRef.height = canvasRef.offsetHeight;\r\n      const ctx = canvasRef.getContext(\"2d\");\r\n      setCanvas(canvasRef);\r\n      setContext(ctx);\r\n      if (!ctx) {\r\n        return;\r\n      }\r\n      ctx.fillStyle = \"rgba(255, 255, 255, 0)\";\r\n      ctx.fillRect(0, 0, canvasRef.width, canvasRef.height);\r\n      ctx.fillStyle = \"transparent\";\r\n      if (history) {\r\n        history.setContext(ctx);\r\n        history.pushState(canvasRef);\r\n      }\r\n    },\r\n    [history]\r\n  );\r\n\r\n  const mouseEnter = useCallback(\r\n    (event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) => {\r\n      if (mouseButtonIsDown(event.buttons)) {\r\n        mouseDown(event);\r\n      } else if (drawing) {\r\n        endStroke();\r\n      }\r\n    },\r\n    [drawing, mouseDown, endStroke]\r\n  );\r\n\r\n  const mouseLeave = useCallback(\r\n    (event: React.MouseEvent<HTMLCanvasElement, MouseEvent>) => {\r\n      if (!drawing) {\r\n        return;\r\n      }\r\n      continueStroke(getMousePoint(event));\r\n      endStroke();\r\n    },\r\n    [continueStroke, drawing, endStroke]\r\n  );\r\n\r\n  useImperativeHandle(\r\n    ref,\r\n    () => ({\r\n      download: (filename = \"image.png\", type?: string) => {\r\n        if (!canvas) {\r\n          return;\r\n        }\r\n        const a = document.createElement(\"a\");\r\n        a.href = canvas.toDataURL(type);\r\n        a.download = filename;\r\n        a.click();\r\n      },\r\n      clear,\r\n      getImageAsDataUri: (type?: string) => canvas?.toDataURL(type),\r\n      context,\r\n    }),\r\n    [canvas, context, clear]\r\n  );\r\n\r\n  return (\r\n    <canvas\r\n      style={{ cursor: tool?.cursor, touchAction: \"none\", ...style }}\r\n      onTouchStart={touchStart}\r\n      onMouseDown={mouseDown}\r\n      onMouseEnter={mouseEnter}\r\n      onMouseMove={drawing ? mouseMove : undefined}\r\n      onTouchMove={drawing ? touchMove : undefined}\r\n      onMouseUp={endStroke}\r\n      onMouseOut={mouseLeave}\r\n      onTouchEnd={endStroke}\r\n      ref={gotRef}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\n","import { useCallback, useMemo, useRef, useState } from \"react\";\r\n\r\nasync function applyImage(context: CanvasRenderingContext2D, blob: Blob) {\r\n  const img = new Image();\r\n  img.onload = () => {\r\n    context.canvas.width = img.width;\r\n    context.canvas.height = img.height;\r\n    context.drawImage(img, 0, 0);\r\n    URL.revokeObjectURL(img.src);\r\n  };\r\n  img.src = URL.createObjectURL(blob);\r\n}\r\n\r\nexport interface History {\r\n  setContext: (context: CanvasRenderingContext2D) => void;\r\n  pushState: (canvas: HTMLCanvasElement) => Promise<boolean>;\r\n}\r\nexport interface HistoryHook {\r\n  history: History;\r\n\r\n  undo: () => Promise<boolean>;\r\n  redo: () => Promise<boolean>;\r\n  clear: () => void;\r\n  canUndo: boolean;\r\n  canRedo: boolean;\r\n}\r\n\r\nexport function useHistory(size?: number): HistoryHook {\r\n  const stack = useRef<Array<Blob>>([]);\r\n  const crs = useRef(0);\r\n  const [context, setContext] = useState<CanvasRenderingContext2D>();\r\n  const [canUndo, setCanUndo] = useState(false);\r\n  const [canRedo, setCanRedo] = useState(false);\r\n\r\n  const pushState = useCallback(\r\n    async (canvas: HTMLCanvasElement) => {\r\n      const undoCursor = crs.current;\r\n      if (!context) {\r\n        console.error(\"Context not initialised\");\r\n        return false;\r\n      }\r\n      if (undoCursor !== 0) {\r\n        stack.current = stack.current.slice(0, -undoCursor);\r\n        crs.current = 0;\r\n      }\r\n      const blob = await new Promise<Blob | null>((resolve) =>\r\n        canvas.toBlob(resolve)\r\n      );\r\n      if (blob) {\r\n        stack.current.push(blob);\r\n      }\r\n      if (size && stack.current.length > size) {\r\n        stack.current = stack.current.slice(-size);\r\n      }\r\n      setCanUndo(stack.current.length > 1);\r\n      setCanRedo(false);\r\n      return true;\r\n    },\r\n    [crs, stack, context]\r\n  );\r\n  const undo = useCallback(async () => {\r\n    const undoCursor = crs.current;\r\n\r\n    if (!context) {\r\n      console.error(\"Context not initialised\");\r\n      return false;\r\n    }\r\n    if (undoCursor + 1 >= stack.current.length) {\r\n      console.log(\"nope\");\r\n      return false;\r\n    }\r\n\r\n    await applyImage(\r\n      context,\r\n      stack.current[stack.current.length - (undoCursor + 2)]\r\n    );\r\n    crs.current++;\r\n    setCanUndo(crs.current + 1 < stack.current.length);\r\n    setCanRedo(true);\r\n    return true;\r\n  }, [crs, stack, context]);\r\n\r\n  const redo = useCallback(async () => {\r\n    const undoCursor = crs.current;\r\n\r\n    if (!context) {\r\n      console.error(\"Context not initialised\");\r\n      return false;\r\n    }\r\n    if (undoCursor <= 0) {\r\n      return false;\r\n    }\r\n\r\n    await applyImage(context, stack.current[stack.current.length - undoCursor]);\r\n    crs.current--;\r\n    setCanUndo(crs.current + 1 < stack.current.length);\r\n    setCanRedo(crs.current > 0);\r\n    return true;\r\n  }, [stack, crs, context]);\r\n\r\n  const clear = useCallback(() => {\r\n    stack.current = [];\r\n  }, [stack]);\r\n\r\n  const history = useMemo<History>(\r\n    () => ({\r\n      setContext: (context: CanvasRenderingContext2D) => {\r\n        setContext(context);\r\n      },\r\n      pushState,\r\n    }),\r\n    [setContext, pushState]\r\n  );\r\n\r\n  return { history, undo, redo, clear, canUndo, canRedo };\r\n}\r\n","import { useCallback } from \"react\";\r\nimport tinycolor from \"tinycolor2\";\r\nimport { ToolHandlers } from \"../../components/Artboard\";\r\nimport { Point } from \"../../utils/pointUtils\";\r\nimport { circleCursor } from \"../../utils/cursors\";\r\nexport interface UseAirbrushProps {\r\n  color?: string;\r\n  strokeWidth?: number;\r\n}\r\n\r\nexport function useAirbrush({\r\n  color = \"#000000\",\r\n  strokeWidth = 25,\r\n}: UseAirbrushProps): ToolHandlers {\r\n  const startStroke = useCallback(\r\n    (point: Point, context: CanvasRenderingContext2D) => {\r\n      context.globalCompositeOperation = \"darken\";\r\n      context.lineWidth = strokeWidth;\r\n      context.lineJoin = context.lineCap = \"round\";\r\n      context.strokeStyle = color;\r\n      context.shadowBlur = strokeWidth * 0.5;\r\n      context.shadowColor = tinycolor(color)\r\n        .setAlpha(0.5)\r\n        .toPercentageRgbString();\r\n      console.log(context.shadowColor);\r\n      context.moveTo(point[0], point[1]);\r\n      context.beginPath();\r\n    },\r\n    [color, strokeWidth]\r\n  );\r\n\r\n  const endStroke = useCallback((context: CanvasRenderingContext2D) => {\r\n    context.globalCompositeOperation = \"source-over\";\r\n  }, []);\r\n\r\n  const continueStroke = useCallback(\r\n    (point: Point, context: CanvasRenderingContext2D) => {\r\n      context.lineTo(point[0], point[1]);\r\n      context.stroke();\r\n    },\r\n    []\r\n  );\r\n\r\n  const cursor = circleCursor(strokeWidth);\r\n\r\n  return { name: \"Airbrush\", startStroke, continueStroke, endStroke, cursor };\r\n}\r\n","import { useCallback, useRef, useState } from \"react\";\r\n\r\nimport { Bristle, getNewAngle, rotatePoint, varyColour } from \"./brushHelpers\";\r\nimport { ToolHandlers } from \"../../components/Artboard\";\r\nimport { Point } from \"../../utils/pointUtils\";\r\nimport { circleCursor } from \"../../utils/cursors\";\r\n\r\nexport type Brush = Array<Bristle>;\r\n\r\nfunction makeBrush(\r\n  strokeWidth: number,\r\n  colour: string,\r\n  varyBrightness: number\r\n): Brush {\r\n  const brush: Brush = [];\r\n  const bristleCount = Math.round(strokeWidth / 3);\r\n  const gap = strokeWidth / bristleCount;\r\n  for (let i = 0; i < bristleCount; i++) {\r\n    const distance =\r\n      i === 0 ? 0 : gap * i + (Math.random() * gap) / 2 - gap / 2;\r\n    brush.push({\r\n      distance,\r\n      thickness: Math.random() * 2 + 2,\r\n      colour: varyColour(colour, varyBrightness),\r\n    });\r\n  }\r\n  return brush;\r\n}\r\n\r\nconst strokeBristle = (\r\n  origin: Point,\r\n  destination: Point,\r\n  bristle: Bristle,\r\n  controlPoint: Point,\r\n  context: CanvasRenderingContext2D\r\n) => {\r\n  context.beginPath();\r\n  context.moveTo(origin[0], origin[1]);\r\n  context.strokeStyle = bristle.colour;\r\n  context.lineWidth = bristle.thickness;\r\n  context.lineCap = \"round\";\r\n  context.lineJoin = \"round\";\r\n  context.shadowColor = bristle.colour;\r\n  context.shadowBlur = bristle.thickness / 2;\r\n  context.quadraticCurveTo(\r\n    controlPoint[0],\r\n    controlPoint[1],\r\n    destination[0],\r\n    destination[1]\r\n  );\r\n  context.lineTo(destination[0], destination[1]);\r\n  context.stroke();\r\n};\r\n\r\nconst drawStroke = (\r\n  bristles: Brush,\r\n  origin: Point,\r\n  destination: Point,\r\n  oldAngle: number,\r\n  newAngle: number,\r\n  strokeWidth: number,\r\n  context: CanvasRenderingContext2D\r\n) => {\r\n  bristles.forEach((bristle) => {\r\n    context.beginPath();\r\n    const bristleOrigin = rotatePoint(\r\n      bristle.distance - strokeWidth / 2,\r\n      oldAngle,\r\n      origin\r\n    );\r\n\r\n    const bristleDestination = rotatePoint(\r\n      bristle.distance - strokeWidth / 2,\r\n      newAngle,\r\n      destination\r\n    );\r\n    const controlPoint = rotatePoint(\r\n      bristle.distance - strokeWidth / 2,\r\n      newAngle,\r\n      origin\r\n    );\r\n\r\n    strokeBristle(\r\n      bristleOrigin,\r\n      bristleDestination,\r\n      bristle,\r\n      controlPoint,\r\n      context\r\n    );\r\n  });\r\n};\r\n\r\nexport interface UseBrushProps {\r\n  color?: string;\r\n  strokeWidth?: number;\r\n  varyBrightness?: number;\r\n}\r\n\r\nexport function useBrush({\r\n  color = \"#000000\",\r\n  strokeWidth = 25,\r\n  varyBrightness = 5,\r\n}: UseBrushProps): ToolHandlers {\r\n  const [brush, setBrush] = useState<Brush>([]);\r\n  const currentAngle = useRef<number>();\r\n  const lastPoint = useRef<Point>();\r\n\r\n  const startStroke = useCallback(\r\n    (point: Point) => {\r\n      currentAngle.current = undefined;\r\n      setBrush(makeBrush(strokeWidth, color, varyBrightness));\r\n      lastPoint.current = point;\r\n    },\r\n    [setBrush, strokeWidth, color, varyBrightness]\r\n  );\r\n\r\n  const continueStroke = useCallback(\r\n    (newPoint: Point, context: CanvasRenderingContext2D) => {\r\n      if (!lastPoint.current) {\r\n        lastPoint.current = newPoint;\r\n        return;\r\n      }\r\n      const newAngle = getNewAngle(\r\n        lastPoint.current,\r\n        newPoint,\r\n        currentAngle.current\r\n      );\r\n      if (typeof currentAngle.current === \"undefined\") {\r\n        currentAngle.current = newAngle % (Math.PI * 2);\r\n      }\r\n      drawStroke(\r\n        brush,\r\n        lastPoint.current,\r\n        newPoint,\r\n        currentAngle.current,\r\n        newAngle,\r\n        strokeWidth,\r\n        context\r\n      );\r\n      currentAngle.current = newAngle % (Math.PI * 2);\r\n      lastPoint.current = newPoint;\r\n    },\r\n    [brush, strokeWidth]\r\n  );\r\n\r\n  const cursor = circleCursor(strokeWidth);\r\n\r\n  return { name: \"Paintbrush\", startStroke, continueStroke, cursor };\r\n}\r\n","import { useCallback } from \"react\";\r\nimport { ToolHandlers } from \"../../components/Artboard\";\r\nimport { Point } from \"../../utils/pointUtils\";\r\nimport { circleCursor } from \"../../utils/cursors\";\r\nexport interface UseEraserProps {\r\n  color?: string;\r\n  strokeWidth?: number;\r\n}\r\n\r\nexport function useEraser({ strokeWidth = 25 }: UseEraserProps): ToolHandlers {\r\n  const startStroke = useCallback(\r\n    (point: Point, context: CanvasRenderingContext2D) => {\r\n      context.globalCompositeOperation = \"source-over\";\r\n\r\n      context.lineWidth = strokeWidth;\r\n      context.strokeStyle = \"#ffffff\";\r\n      context.lineJoin = context.lineCap = \"round\";\r\n      context.moveTo(point[0], point[1]);\r\n      context.beginPath();\r\n    },\r\n    [strokeWidth]\r\n  );\r\n\r\n  const continueStroke = useCallback(\r\n    (point: Point, context: CanvasRenderingContext2D) => {\r\n      context.lineTo(point[0], point[1]);\r\n      context.stroke();\r\n    },\r\n    []\r\n  );\r\n\r\n  const cursor = circleCursor(strokeWidth);\r\n\r\n  return { name: \"Eraser\", startStroke, continueStroke, cursor };\r\n}\r\n","import { useCallback, useRef } from \"react\";\r\n\r\nimport { ToolHandlers } from \"../../components/Artboard\";\r\nimport { Point } from \"../../utils/pointUtils\";\r\nimport { circleCursor } from \"../../utils/cursors\";\r\nexport interface UseMarkerProps {\r\n  color?: string;\r\n  strokeWidth?: number;\r\n}\r\n\r\nexport function useMarker({\r\n  color = \"#000000\",\r\n  strokeWidth = 25,\r\n}: UseMarkerProps): ToolHandlers {\r\n  const lastPoint = useRef<Point>();\r\n\r\n  const startStroke = useCallback(\r\n    (point: Point, context: CanvasRenderingContext2D) => {\r\n      context.lineWidth = 3;\r\n      context.lineJoin = context.lineCap = \"round\";\r\n      lastPoint.current = point;\r\n      context.strokeStyle = color;\r\n    },\r\n    [color]\r\n  );\r\n\r\n  const continueStroke = useCallback(\r\n    (newPoint: Point, context: CanvasRenderingContext2D) => {\r\n      if (!lastPoint.current) {\r\n        lastPoint.current = newPoint;\r\n        return;\r\n      }\r\n      if (\r\n        lastPoint.current[0] === newPoint[0] &&\r\n        lastPoint.current[1] === newPoint[1]\r\n      ) {\r\n        return;\r\n      }\r\n      context.beginPath();\r\n\r\n      for (let i = 0; i < strokeWidth; i += 2) {\r\n        const offset = Math.round(strokeWidth / 2 - i);\r\n        context.globalAlpha = (1 / strokeWidth) * (strokeWidth - i);\r\n        context.moveTo(\r\n          lastPoint.current[0] - offset,\r\n          lastPoint.current[1] - offset\r\n        );\r\n        context.lineTo(newPoint[0] - offset, newPoint[1] - offset);\r\n        context.stroke();\r\n      }\r\n      context.globalAlpha = 1;\r\n      context.beginPath();\r\n\r\n      lastPoint.current = newPoint;\r\n    },\r\n    [strokeWidth, lastPoint]\r\n  );\r\n\r\n  const cursor = circleCursor(strokeWidth);\r\n\r\n  return { name: \"Marker pen\", startStroke, continueStroke, cursor };\r\n}\r\n","import { useCallback, useRef } from \"react\";\r\nimport tinycolor from \"tinycolor2\";\r\n\r\nimport { ToolHandlers } from \"../../components/Artboard\";\r\nimport { Point } from \"../../utils/pointUtils\";\r\nexport interface UseShadingProps {\r\n  color?: string;\r\n  neighbourColor?: string;\r\n  neighbourStrokeWidth?: number;\r\n  distanceThreshold?: number;\r\n  spreadFactor?: number;\r\n}\r\n\r\nexport function useShadingBrush({\r\n  color = \"#000000\",\r\n  neighbourColor,\r\n  distanceThreshold = 40,\r\n  neighbourStrokeWidth = 1,\r\n  spreadFactor = 0.9,\r\n}: UseShadingProps): ToolHandlers {\r\n  neighbourColor ||= tinycolor(color).setAlpha(0.2).toPercentageRgbString();\r\n  const points = useRef<Array<Point>>([]);\r\n  const threshold = distanceThreshold * distanceThreshold;\r\n\r\n  const startStroke = useCallback(\r\n    (point: Point, context: CanvasRenderingContext2D) => {\r\n      context.globalCompositeOperation = \"darken\";\r\n      context.lineWidth = 1;\r\n      context.lineJoin = context.lineCap = \"round\";\r\n      points.current = [point];\r\n    },\r\n    []\r\n  );\r\n\r\n  const continueStroke = useCallback(\r\n    (newPoint: Point, context: CanvasRenderingContext2D) => {\r\n      context.strokeStyle = color;\r\n      context.lineWidth = 1;\r\n\r\n      points.current.push(newPoint);\r\n      context.beginPath();\r\n      const [prevX, prevY] = points.current[points.current.length - 2];\r\n      context.moveTo(prevX, prevY);\r\n      context.lineTo(...newPoint);\r\n      context.stroke();\r\n      context.lineWidth = neighbourStrokeWidth;\r\n\r\n      for (const point of points.current) {\r\n        const dx = point[0] - newPoint[0];\r\n        const dy = point[1] - newPoint[1];\r\n        const distance = dx * dx + dy * dy;\r\n\r\n        if (distance < threshold && Math.random() > distance / threshold) {\r\n          context.beginPath();\r\n          context.strokeStyle = neighbourColor as string;\r\n          context.moveTo(\r\n            newPoint[0] + dx * spreadFactor,\r\n            newPoint[1] + dy * spreadFactor\r\n          );\r\n          context.lineTo(\r\n            point[0] - dx * spreadFactor,\r\n            point[1] - dy * spreadFactor\r\n          );\r\n          context.stroke();\r\n        }\r\n      }\r\n    },\r\n    [neighbourStrokeWidth, color, spreadFactor, threshold, neighbourColor]\r\n  );\r\n\r\n  const endStroke = useCallback((context: CanvasRenderingContext2D) => {\r\n    context.globalCompositeOperation = \"source-over\";\r\n  }, []);\r\n  const cursor = \"crosshair\";\r\n\r\n  return { name: \"Shading\", startStroke, continueStroke, endStroke, cursor };\r\n}\r\n","import { useCallback, useRef } from \"react\";\r\nimport { ToolHandlers } from \"../../components/Artboard\";\r\nimport { Point } from \"../../utils/pointUtils\";\r\nimport { circleCursor } from \"../../utils/cursors\";\r\nimport { splodgeTrail } from \"./watercolor\";\r\n\r\nexport interface UseWatercolorProps {\r\n  color?: string;\r\n  strokeWidth?: number;\r\n}\r\n\r\nexport function useWatercolor({\r\n  color = \"#000000\",\r\n  strokeWidth = 25,\r\n}: UseWatercolorProps): ToolHandlers {\r\n  const points = useRef<Array<Point>>([]);\r\n\r\n  const startStroke = useCallback(\r\n    (point: Point, context: CanvasRenderingContext2D) => {\r\n      context.fillStyle = color;\r\n      context.shadowColor = color;\r\n      context.globalAlpha = 0.01;\r\n      points.current = [point];\r\n      splodgeTrail(points.current, strokeWidth * 1.1, 1, context);\r\n    },\r\n    [color, strokeWidth]\r\n  );\r\n\r\n  const endStroke = useCallback(() => {\r\n    points.current = [];\r\n  }, []);\r\n\r\n  const continueStroke = useCallback(\r\n    (point: Point, context: CanvasRenderingContext2D) => {\r\n      points.current.push(point);\r\n      splodgeTrail(points.current, strokeWidth, 5, context);\r\n    },\r\n    [strokeWidth]\r\n  );\r\n\r\n  const cursor = circleCursor(strokeWidth);\r\n\r\n  return { name: \"Watercolor\", startStroke, continueStroke, endStroke, cursor };\r\n}\r\n"],"names":["varyColour","sourceColour","varyBrightness","amount","Math","round","random","alpha","tinycolor","darken","setAlpha","toPercentageRgbString","rotatePoint","distance","angle","origin","cos","sin","circleCursor","diameter","btoa","circleSVG","circleDataUri","spareRandom","normalRandom","val","u","v","s","mul","sqrt","log","subdivideVertex","currentPoint","nextPoint","depth","variance","vdiv","midY","newMidpoint","newPoints","push","apply","splodgeAtPoint","point","context","width","beginPath","sides","radius","points","i","length","deformPolygon","centre","increment","PI","result","makePolygon","getSplodge","forEach","lineTo","closePath","fill","splodgeTrail","trail","count","min","globalAlpha","getTouchPoint","event","currentTarget","rect","getBoundingClientRect","touch","targetTouches","clientX","left","clientY","top","getMousePoint","nativeEvent","offsetX","offsetY","mouseButtonIsDown","buttons","Artboard","forwardRef","_ref","ref","tool","style","history","onStartStroke","onContinueStroke","onEndStroke","props","_objectWithoutPropertiesLoose","_excluded","_useState","useState","setContext","_useState2","canvas","setCanvas","_useState3","drawing","setDrawing","startStroke","useCallback","save","continueStroke","newPoint","endStroke","restore","pushState","mouseMove","touchMove","mouseDown","preventDefault","touchStart","clear","fillStyle","fillRect","height","gotRef","canvasRef","offsetWidth","offsetHeight","ctx","getContext","mouseEnter","mouseLeave","useImperativeHandle","download","filename","type","a","document","createElement","href","toDataURL","click","getImageAsDataUri","React","_extends","cursor","touchAction","onTouchStart","onMouseDown","onMouseEnter","onMouseMove","undefined","onTouchMove","onMouseUp","onMouseOut","onTouchEnd","applyImage","blob","img","Image","onload","drawImage","URL","revokeObjectURL","src","createObjectURL","Promise","resolve","e","reject","_ref$color","color","_ref$strokeWidth","strokeWidth","globalCompositeOperation","lineWidth","lineJoin","lineCap","strokeStyle","shadowBlur","shadowColor","console","moveTo","name","stroke","_ref$varyBrightness","brush","setBrush","currentAngle","useRef","lastPoint","current","colour","bristleCount","gap","thickness","makeBrush","newAngle","oldAngle","destination","bearing","atan2","angleB","twoPi","diff","bristles","bristle","controlPoint","quadraticCurveTo","strokeBristle","drawStroke","size","stack","crs","canUndo","setCanUndo","canRedo","setCanRedo","undoCursor","slice","toBlob","then","error","undo","redo","useMemo","offset","neighbourColor","_ref$distanceThreshol","distanceThreshold","_ref$neighbourStrokeW","neighbourStrokeWidth","_ref$spreadFactor","spreadFactor","threshold","_points$current","prevY","_iterator","_step","_createForOfIteratorHelperLoose","done","value","dx","dy"],"mappings":"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"}